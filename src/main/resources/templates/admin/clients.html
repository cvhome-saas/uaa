<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Create OAuth Client</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        form { max-width: 560px; display: grid; gap: .75rem; }
        label { display: grid; gap: .25rem; }
        input, select, textarea { padding: .5rem; font-size: 1rem; }
        button { padding: .6rem 1rem; font-size: 1rem; }
        .note { color: #555; font-size: .9rem; }
        pre { background: #f5f5f5; padding: .75rem; }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
<h2>Create OAuth Client</h2>

<form th:action="@{/admin/clients/new}" method="post">
    <label>Client Name
        <input name="clientName" placeholder="My Web App" required />
    </label>

    <!-- Removed legacy Type selector; use grant/auth method defaults in controller/service -->

    <label>Redirect URIs (comma separated)
        <input name="redirectUris" placeholder="https://app.example.com/callback, http://127.0.0.1:3000/cb" />
        <div class="note">Used for Authorization Code clients. Leave empty for machine clients.</div>
    </label>

    <label>Scopes (comma separated)
        <input name="scopes" placeholder="openid, profile, api.read" />
        <div class="note">Defaults to: openid,profile for code; api.read,api.write for machine</div>
    </label>

    <button type="submit">Create</button>
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
  </form>

<div th:if="${result != null}">
    <h3>Client created</h3>
    <p><strong>client_id:</strong> <span th:text="${result.clientId}"></span></p>
    <div th:if="${result.clientSecret != null}">
        <p><strong>client_secret:</strong></p>
        <pre th:text="${result.clientSecret}"></pre>
        <p class="note">Copy and store the secret now. It will not be shown again.</p>
    </div>
</div>

<script>
  // Enhance comma-separated fields into multi-value params for Spring @RequestParam Set<String>
  const form = document.querySelector('form');
  form.addEventListener('submit', (e) => {
    const ru = form.querySelector('input[name="redirectUris"]').value;
    const sc = form.querySelector('input[name="scopes"]').value;
    const addHiddenList = (name, value) => {
      if (!value) return;
      value.split(',').map(v => v.trim()).filter(Boolean).forEach(v => {
        const inp = document.createElement('input');
        inp.type = 'hidden';
        inp.name = name;
        inp.value = v;
        form.appendChild(inp);
      });
    };
    addHiddenList('redirectUris', ru);
    addHiddenList('scopes', sc);
  });
  </script>
</body>
</html>
